<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bay Area Transit - Historic, Current & Future</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 100vh;
            width: 100vw;
        }
        .legend {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            line-height: 24px;
            font-size: 14px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .legend-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .legend-item {
            margin: 5px 0;
        }
        .legend-line {
            display: inline-block;
            width: 30px;
            height: 3px;
            margin-right: 8px;
            vertical-align: middle;
        }
        .layer-control {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            font-size: 14px;
        }
        .layer-control-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 15px;
        }
        .layer-toggle {
            margin: 10px 0;
        }
        .layer-toggle input {
            margin-right: 8px;
        }
        .layer-toggle label {
            cursor: pointer;
            user-select: none;
        }
        /* Editable style variables */
        :root {
            /* Historic colors */
            --historic-muni: #E31937;
            --historic-market: #D4145A;
            --historic-key: #1E88E5;
            --historic-interurban: #7B1FA2;
            /* Current colors */
            --bart-red: #ED1C24;
            --bart-yellow: #FFE800;
            --bart-orange: #FF9933;
            --bart-green: #4DB848;
            --bart-blue: #0099CC;
            --caltrain-red: #E31837;
            --muni-color: #8B8D8E;
            --vta-blue: #0077C8;
            --vta-orange: #FF6A13;
            --vta-green: #00914A;
            --amtrak-color: #003B5C;
            --ace-color: #8B1A4F;
            --smart-color: #006838;
            /* Future colors */
            --future-bart: #FF1493;
            --future-muni: #9370DB;
            --future-vta: #FF6347;
            --future-caltrain: #FF8C00;
            --future-smart: #32CD32;
            --future-valley: #4169E1;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Initialize map centered on Bay Area
        const map = L.map('map').setView([37.7749, -122.2194], 10);

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Layer groups for each era
        const historicLayer = L.layerGroup();
        const currentLayer = L.layerGroup();
        const futureLayer = L.layerGroup();

        // =============== HISTORIC TRANSIT DATA (1920s-1940s) ===============
        const historicData = {
            muniRoutes: [
                {coords: [[37.7067, -122.4708], [37.7498, -122.4265]], name: "J Church", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7185, -122.4568], [37.7498, -122.4265]], name: "K Ingleside", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7427, -122.5066], [37.7498, -122.4265]], name: "L Taraval", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7230, -122.4690], [37.7498, -122.4265]], name: "M Ocean View", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7605, -122.5101], [37.7498, -122.4265]], name: "N Judah", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7817, -122.5133], [37.7863, -122.4079]], name: "B Geary", color: "var(--historic-muni, #E31937)"},
                {coords: [[37.7817, -122.5000], [37.7863, -122.4079]], name: "C Geary", color: "var(--historic-muni, #E31937)"}
            ],
            marketStreetRoutes: [
                {coords: [[37.7089, -122.4397], [37.7933, -122.3984]], name: "Mission St", color: "var(--historic-market, #D4145A)"},
                {coords: [[37.7576, -122.4027], [37.7863, -122.4079]], name: "Potrero", color: "var(--historic-market, #D4145A)"},
                {coords: [[37.7031, -122.4210], [37.7863, -122.4079]], name: "Valencia", color: "var(--historic-market, #D4145A)"},
                {coords: [[37.7722, -122.4480], [37.7863, -122.4079]], name: "Haight St", color: "var(--historic-market, #D4145A)"},
                {coords: [[37.7625, -122.4350], [37.7863, -122.4079]], name: "Castro", color: "var(--historic-market, #D4145A)"},
                {coords: [[37.7985, -122.4102], [37.7863, -122.4079]], name: "Union-Stockton", color: "var(--historic-market, #D4145A)"}
            ],
            keySystemRoutes: [
                {coords: [[37.8044, -122.2712], [37.7933, -122.3984]], name: "Key Transbay", color: "var(--historic-key, #1E88E5)"},
                {coords: [[37.8715, -122.2730], [37.8044, -122.2712]], name: "Berkeley", color: "var(--historic-key, #1E88E5)"},
                {coords: [[37.8272, -122.2322], [37.8044, -122.2712]], name: "Oakland-Piedmont", color: "var(--historic-key, #1E88E5)"},
                {coords: [[37.7655, -122.2416], [37.8044, -122.2712]], name: "Alameda", color: "var(--historic-key, #1E88E5)"},
                {coords: [[37.7249, -122.1561], [37.8044, -122.2712]], name: "San Leandro", color: "var(--historic-key, #1E88E5)"},
                {coords: [[37.7758, -122.2248], [37.8044, -122.2712]], name: "East 14th St", color: "var(--historic-key, #1E88E5)"}
            ],
            interurbanRoutes: [
                {coords: [[37.8044, -122.2712], [37.3382, -121.8863]], name: "Oakland-San Jose", color: "var(--historic-interurban, #7B1FA2)"},
                {coords: [[37.8044, -122.2712], [37.9358, -122.3477]], name: "East Shore", color: "var(--historic-interurban, #7B1FA2)"},
                {coords: [[37.7933, -122.3984], [37.3382, -121.8863]], name: "Peninsula Commute", color: "var(--historic-interurban, #7B1FA2)"}
            ]
        };

        // Draw historic routes
        Object.values(historicData).flat().forEach(route => {
            L.polyline(route.coords, {
                color: getComputedStyle(document.documentElement).getPropertyValue(route.color.replace('var(', '').replace(')', '').split(',')[0]).trim() || route.color.split(',')[1].replace(')', '').trim(),
                weight: 3,
                opacity: 0.7
            }).bindPopup(`<b>Historic: ${route.name}</b><br>Era: 1920s-1940s`).addTo(historicLayer);
        });

        // =============== CURRENT TRANSIT DATA (2026) ===============
        const currentData = {
            bartLines: [
                {coords: [[37.9368, -122.3534], [37.7033, -122.4668], [37.6213, -122.4009]], name: "Red Line", color: "#ED1C24"},
                {coords: [[37.9955, -121.7802], [37.8715, -122.2697], [37.7933, -122.3968], [37.6213, -122.4009]], name: "Yellow Line", color: "#FFE800"},
                {coords: [[37.9368, -122.3534], [37.8044, -122.2708], [37.3696, -121.8743]], name: "Orange Line", color: "#FF9933"},
                {coords: [[37.3696, -121.8743], [37.7933, -122.3968], [37.7062, -122.4698]], name: "Green Line", color: "#4DB848"},
                {coords: [[37.7018, -121.8996], [37.8044, -122.2708], [37.7062, -122.4698]], name: "Blue Line", color: "#0099CC"}
            ],
            caltrain: [
                {coords: [[37.7764, -122.3943], [37.4530, -122.1817], [37.3541, -121.9552], [37.3299, -121.9017]], name: "Caltrain", color: "#E31837"}
            ],
            muniLines: [
                {coords: [[37.7067, -122.4708], [37.7498, -122.4265], [37.7933, -122.3968]], name: "J Church", color: "#8B8D8E"},
                {coords: [[37.7185, -122.4568], [37.7498, -122.4265], [37.7933, -122.3968]], name: "K Ingleside", color: "#8B8D8E"},
                {coords: [[37.7427, -122.5066], [37.7498, -122.4265], [37.7933, -122.3968]], name: "L Taraval", color: "#8B8D8E"},
                {coords: [[37.7230, -122.4690], [37.7498, -122.4265], [37.7933, -122.3968]], name: "M Ocean View", color: "#8B8D8E"},
                {coords: [[37.7605, -122.5101], [37.7498, -122.4265], [37.7933, -122.3968]], name: "N Judah", color: "#8B8D8E"},
                {coords: [[37.7133, -122.4693], [37.7933, -122.3968]], name: "S Shuttle", color: "#8B8D8E"},
                {coords: [[37.7850, -122.4697], [37.7933, -122.3968]], name: "T Third", color: "#8B8D8E"}
            ],
            vtaLines: [
                {coords: [[37.4070, -121.9550], [37.3541, -121.9552], [37.2363, -121.7512]], name: "VTA Blue", color: "#0077C8"},
                {coords: [[37.3696, -121.8743], [37.3541, -121.9552], [37.3944, -122.0768]], name: "VTA Orange", color: "#FF6A13"},
                {coords: [[37.3117, -121.9509], [37.3541, -121.9552], [37.4070, -121.9550]], name: "VTA Green", color: "#00914A"}
            ],
            other: [
                {coords: [[38.5816, -121.4944], [37.9368, -122.3534], [37.8044, -122.2708], [37.7764, -122.3943], [37.3299, -121.9017]], name: "Amtrak Capitol", color: "#003B5C"},
                {coords: [[37.9522, -121.2908], [37.7018, -121.8996], [37.3299, -121.9017]], name: "ACE", color: "#8B1A4F"},
                {coords: [[38.5088, -122.8009], [38.2382, -122.6372]], name: "SMART", color: "#006838"}
            ]
        };

        const currentStations = [
            {coords: [37.9368, -122.3534], name: "Richmond BART"},
            {coords: [37.8715, -122.2697], name: "Berkeley Downtown BART"},
            {coords: [37.8044, -122.2708], name: "Oakland 12th St BART"},
            {coords: [37.7933, -122.3968], name: "Embarcadero BART"},
            {coords: [37.7062, -122.4698], name: "Daly City BART"},
            {coords: [37.6213, -122.4009], name: "Millbrae BART"},
            {coords: [37.7018, -121.8996], name: "Dublin/Pleasanton BART"},
            {coords: [37.3696, -121.8743], name: "Berryessa BART"},
            {coords: [37.9955, -121.7802], name: "Antioch BART"},
            {coords: [37.7764, -122.3943], name: "SF 4th & King Caltrain"},
            {coords: [37.3299, -121.9017], name: "San José Diridon"}
        ];

        // Draw current routes
        Object.values(currentData).flat().forEach(route => {
            L.polyline(route.coords, {
                color: route.color,
                weight: 4,
                opacity: 0.9
            }).bindPopup(`<b>Current: ${route.name}</b>`).addTo(currentLayer);
        });

        // Draw current stations
        currentStations.forEach(station => {
            L.circleMarker(station.coords, {
                radius: 6,
                fillColor: '#333',
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            }).bindPopup(`<b>${station.name}</b>`).addTo(currentLayer);
        });

        // =============== FUTURE TRANSIT DATA ===============
        const futureData = {
            bartExtensions: [
                {coords: [[37.3696, -121.8743], [37.3297, -121.9017], [37.3541, -121.9552], [37.3521, -121.9365]], name: "BART Phase II to Santa Clara", color: "#FF1493"}
            ],
            caltrainFuture: [
                {coords: [[37.7764, -122.3943], [37.3299, -121.9017]], name: "Caltrain/HSR Corridor", color: "#FF8C00"}
            ],
            muniFuture: [
                {coords: [[37.7191, -122.4425], [37.7062, -122.4698]], name: "Geneva-Harney", color: "#9370DB"},
                {coords: [[37.7989, -122.4070], [37.8080, -122.4177]], name: "Central Subway Ext", color: "#9370DB"},
                {coords: [[37.7817, -122.5133], [37.7863, -122.4079]], name: "Geary Rail", color: "#9370DB"}
            ],
            vtaFuture: [
                {coords: [[37.3696, -121.8743], [37.3541, -121.9552]], name: "VTA-BART Connection", color: "#FF6347"}
            ],
            smartFuture: [
                {coords: [[38.5088, -122.8009], [38.6097, -122.8693]], name: "SMART to Healdsburg", color: "#32CD32"}
            ],
            valleyLink: [
                {coords: [[37.7018, -121.8996], [37.8260, -121.5654]], name: "Valley Link", color: "#4169E1"}
            ]
        };

        const futureStations = [
            {coords: [37.3351, -121.8866], name: "28th St/Little Portugal BART (2037)", color: "#FF1493"},
            {coords: [37.3341, -121.8881], name: "Downtown San José BART (2037)", color: "#FF1493"},
            {coords: [37.3297, -121.9017], name: "Diridon BART (2037)", color: "#FF1493"},
            {coords: [37.3521, -121.9365], name: "Santa Clara BART (2037)", color: "#FF1493"},
            {coords: [37.5281, -121.9763], name: "Irvington BART (2031)", color: "#FF1493"},
            {coords: [37.8080, -122.4177], name: "North Beach Muni", color: "#9370DB"},
            {coords: [38.6097, -122.8693], name: "Healdsburg SMART", color: "#32CD32"},
            {coords: [37.8260, -121.5654], name: "Mountain House Valley Link", color: "#4169E1"}
        ];

        // Draw future routes (dashed)
        Object.values(futureData).flat().forEach(route => {
            L.polyline(route.coords, {
                color: route.color,
                weight: 4,
                opacity: 0.8,
                dashArray: '10, 10'
            }).bindPopup(`<b>Future: ${route.name}</b><br>Status: Planned`).addTo(futureLayer);
        });

        // Draw future stations
        futureStations.forEach(station => {
            L.circleMarker(station.coords, {
                radius: 7,
                fillColor: station.color,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9
            }).bindPopup(`<b>${station.name}</b>`).addTo(futureLayer);
        });

        // Add all layers to map by default
        historicLayer.addTo(map);
        currentLayer.addTo(map);
        futureLayer.addTo(map);

        // Add layer control
        const layerControl = L.control({position: 'topleft'});
        layerControl.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'layer-control');
            div.innerHTML = `
                <div class="layer-control-title">Toggle Transit Eras</div>
                <div class="layer-toggle">
                    <input type="checkbox" id="historic-toggle" checked>
                    <label for="historic-toggle">Historic (1920s-1940s)</label>
                </div>
                <div class="layer-toggle">
                    <input type="checkbox" id="current-toggle" checked>
                    <label for="current-toggle">Current (2026)</label>
                </div>
                <div class="layer-toggle">
                    <input type="checkbox" id="future-toggle" checked>
                    <label for="future-toggle">Future/Planned</label>
                </div>
            `;

            // Prevent map interactions when clicking control
            L.DomEvent.disableClickPropagation(div);

            return div;
        };
        layerControl.addTo(map);

        // Add event listeners for toggles
        setTimeout(() => {
            document.getElementById('historic-toggle').addEventListener('change', function(e) {
                if (e.target.checked) {
                    map.addLayer(historicLayer);
                } else {
                    map.removeLayer(historicLayer);
                }
            });

            document.getElementById('current-toggle').addEventListener('change', function(e) {
                if (e.target.checked) {
                    map.addLayer(currentLayer);
                } else {
                    map.removeLayer(currentLayer);
                }
            });

            document.getElementById('future-toggle').addEventListener('change', function(e) {
                if (e.target.checked) {
                    map.addLayer(futureLayer);
                } else {
                    map.removeLayer(futureLayer);
                }
            });
        }, 100);

        // Add comprehensive legend
        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <div class="legend-title">Bay Area Transit Map</div>
                <div style="margin-bottom: 10px;"><b>Historic (1920s-1940s)</b></div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--historic-muni, #E31937);"></span>
                    Municipal Railway
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--historic-market, #D4145A);"></span>
                    Market Street Railway
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--historic-key, #1E88E5);"></span>
                    Key System
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--historic-interurban, #7B1FA2);"></span>
                    Interurban Lines
                </div>
                <div style="margin: 15px 0 10px;"><b>Current (2026)</b></div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--bart-red, #ED1C24);"></span>
                    BART (5 lines)
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--caltrain-red, #E31837);"></span>
                    Caltrain
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--muni-color, #8B8D8E);"></span>
                    Muni Metro
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--vta-blue, #0077C8);"></span>
                    VTA Light Rail
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--amtrak-color, #003B5C);"></span>
                    Amtrak/ACE
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="background: var(--smart-color, #006838);"></span>
                    SMART
                </div>
                <div style="margin: 15px 0 10px;"><b>Future/Planned</b></div>
                <div class="legend-item">
                    <span class="legend-line" style="border-top: 3px dashed var(--future-bart, #FF1493);"></span>
                    BART Extensions
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="border-top: 3px dashed var(--future-muni, #9370DB);"></span>
                    Muni Expansions
                </div>
                <div class="legend-item">
                    <span class="legend-line" style="border-top: 3px dashed var(--future-valley, #4169E1);"></span>
                    New Systems
                </div>
            `;
            return div;
        };
        legend.addTo(map);
    </script>
</body>
</html>